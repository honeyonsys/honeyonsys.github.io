<!DOCTYPE html>
<html>

<head>
    <title>Setting up rest api project with python django?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Harish Kumar">
    <meta name="description" itemprop="description"
        content="Steps to setup django project to create a rest api" />
    <meta name="keywords" itemprop="keywords"
        content="rest-api, python, django, setup, honeyonsys, harish kumar, python developer, sage consultant" />
    <meta property="og:title" content="Setting up rest api project with python(Django)" />
    <meta property="og:site_name" content="https://honeyonsys.github.io" />
    <meta property="og:type" content="article" />
    <meta property="og:description"
        content="Steps to setup django project to create a rest api" />
    <meta property="og:url"
        content="http://honeyonsys.github.io/articles/0020-setting-up-rest-api-project-with-python-django.html" />
    <meta property="og:image" content="https://honeyonsys.github.io/assets/img/blogs/0020_ogimg.png" />
    <meta name="google-site-verification" content="i5nQMNLum8SfICqLyuLLrFe19CDl31K07aHRLpcuqlI" />
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="icon" href="../assets/img/favicon.ico" type="image/ico" sizes="16x16">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-27880645-1"></script>
    <script src="../assets/js/g-analytics.js"></script>
    <link href="../assets/css/prism.css" rel="stylesheet" />
    <script src="../assets/js/prism.js"></script>
</head>

<body>
    <div id="pageIdentity">article</div>
    <div class="profile_pic">
        <a href="https://honeyonsys.github.io"><img src="https://honeyonsys.github.io/assets/img/honeyonsys_logo_vertical.png" alt="freelance web application developer" /></a>        
    </div>
    <div id="rightArea">
        <div id="singleBlog">
            <div class="blog">
                <div class="blogTitle">
                    <h1><a href="0020-setting-up-rest-api-project-with-python-django.html">
                        Setting up rest api project with python(django)</a>
                    </h1>
                </div>
                <div class="blogBelowLine">
                    <div class="blogTags">rest-api</div>
                    <div class="blogTags">python</div>
                    <div class="blogTags">django</div>
                    <div class="datePublished">published on: 26 Feb 2022<span></span></div>
                </div>
                <div class="Ad728">
                    <script type="text/javascript" src="../assets/js/728adcode.js"></script>
                </div>
                <div class="blogDescription">
                    <p>I am assuming that python is already installed on your system and "pip" command is working. If yes then the following steps should work:</p>
                    <p><b>1.</b> Open your command prompt and execute command:</p>
                    <pre><code class="lang-powershell">$> pip install django</code></pre>
                    <p><b>2.</b> To create rest api we need to install django rest framework.</p>
                    <pre><code class="lang-powershell">$> pip install djangorestframework</code></pre>
                    <p><b>3.</b> By default the django project comes with a security that blocks request coming from different domains. To disable this lets install django cors headers module.</p>
                    <pre><code class="lang-powershell">$> pip install django-cors-headers</code></pre>
                    <p><b>4.</b> Now lets create a django project. Open the command prompt in desired folder and type command.</p>
                    <pre><code class="lang-powershell">$> django-admin startproject RestProject</code></pre>
                    <p>After execute above command a folder should create on the same directory names "RestProject"</p>
                    <p><img src="../assets/img/blogs/0020_1.png"></p>
                    <p><b>5.</b> Open that folder in VSCode or code editor of your choice. You will see file structure like following image.</p>
                    <p><img src="../assets/img/blogs/0020_2.png"></p>
                    <p><b>__init__.py</b> is just an empty file that indicates that the given folder is a python project or module<br>
                        <b>asgi.py</b> is the entry point for the ASGI compatible web servers<br>
                        <b>settings.py</b> contains all the settings and configurations needed for the project<br>
                        <b>urls.py</b> contains all the url declarations needed for this project<br>
                        <b>wsgi.py</b> is the entry point for the WSGI compatible web servers<br>
                        <b>manage.py</b> is a command line utility that helps intract with django project</p>
                    <p><b>6.</b> Now the project is setup, lets run the peoject to see how its look in the browser. Just type following command</p>
                    <pre><code class="lang-powershell">$> python manage.py runserver</code></pre>
                    <p>and you will see the url where you django app is running.</p>
                    <p><img src="../assets/img/blogs/0020_3.png"></p>
                    <p>copy that url and paste it to the browser, you will see a default django page like below</p>
                    <p><img src="../assets/img/blogs/0020_4.png"></p>
                    <p>Now the django is running successfully on your system. Lets do the further things. </p>
                    <p><b>7.</b> Create a app in your django project (The current folder structure which you see is a project but app is different than project. A project may have multiple apps in it). To create an app execute the following command.</p>
                    <pre><code class="lang-powershell">$> python manage.py startapp EmployeeApp</code></pre>
                    <p><img src="../assets/img/blogs/0020_5.png"></p>
                    <p><b>8.</b> Let us register the app in the required module in project's settings.py file. In the <b>INSTALLED_APPS</b> section lets add <b>'rest_framework'</b>, <b>'corsheaders'</b> and <b>'EmployeeApp.apps.EmployeeappConfig'</b></p>
                    <pre>
                    <code class="lang-json">
                    INSTALLED_APPS = [
                        'django.contrib.admin',
                        'django.contrib.auth',
                        'django.contrib.contenttypes',
                        'django.contrib.sessions',
                        'django.contrib.messages',
                        'django.contrib.staticfiles',
                        'rest_framework',
                        'corsheaders',
                        'EmployeeApp.apps.EmployeeappConfig'
                    ]
                    </code>
                    </pre>
                    <p><b>MIDDLEWARE</b> section add <b>'corsheaders.middleware.CorsMiddleware'</b></p>
                    <pre>
                    <code class="lang-json">
                    MIDDLEWARE = [
                        'corsheaders.middleware.CorsMiddleware',
                        'django.middleware.security.SecurityMiddleware',
                        'django.contrib.sessions.middleware.SessionMiddleware',
                        'django.middleware.common.CommonMiddleware',
                        'django.middleware.csrf.CsrfViewMiddleware',
                        'django.contrib.auth.middleware.AuthenticationMiddleware',
                        'django.contrib.messages.middleware.MessageMiddleware',
                        'django.middleware.clickjacking.XFrameOptionsMiddleware',
                    ]
                    </code>
                    </pre>
                    <p>We will also add instruction to enable all domains to access the API (This is not recommended in production instead just only those domains that need to be whitelisted)</p>
                    <pre><code class="lang-powershell">CORS_ORIGIN_ALLOW_ALL = True</code></pre>
                    <p><b>9.</b> Lets create models needed for our app. We are creating an EmployeeApp (for an example) for this we need two models: Departments (to store employee's department details) and Employees (to store employee details). Just edit the apps <b>models.py</b> file and insert the following code </p>
                    <pre>
                    <code class="lang-powershell">
                    from django.db import models

                    # Create your models here.
                    class Departments(models.Model):
                        DepartmentId = models.AutoField(primary_key=True)
                        DepartmentName = models.CharField(max_length=500)
                    
                    class Employees(models.Model): 
                        EmployeeId = models.AutoField(primary_key=True)
                        EmployeeName = models.CharField(max_length=500)
                        Department = models.CharField(max_length=500)
                        DateOfJoining = models.DateField()
                        PhotoFileName = models.CharField(max_length=500)
                    </code>
                    </pre>
                    <p><b>10.</b> We will be using MySQL as the database to create the table from these models. Open your mysql databse and create a database named "pythonapitest" (you can create any name of your choice).</p>
                    <p><b>11.</b> Now to connect MySQL from our django app we need to install database adapter. Lets install it with command:</p>
                    <pre><code class="lang-powershell">$> pip install pymysql</code></pre>
                    <p><b>12.</b> Let us now add the database connection details in the main settings.py file.</p>
                    <pre>
                    <code class="lang-powershell">
                    import pymysql
                    pymysql.install_as_MySQLdb()
                    DATABASES = {
                        'default': {
                            'ENGINE': 'django.db.backends.mysql',
                            'NAME': 'pythonapitest',
                            'USER': 'root',
                            'PASSWORD': '123456',
                            'HOST': 'localhost',
                            'PORT': '3306'
                        }
                    }

                    </code>
                    </pre>
                    <p>In python3 there is an issue with this mysql client so we have added pymysql.install_as_MySQLdb()</p>
                    <p><b>13.</b> Now lets run the command to create migration file from our models</p>
                    <pre><code class="lang-powershell">$> python manage.py makemigrations EmployeeApp</code></pre>
                    <p>after executing this we can see a migration file <b>0001_initial.py</b> under EmployeeApp -> migrations will be create which tells us that what changes to the database will be done. Once it looks fine we can execute the command to push these changes to the database </p>
                    <pre><code class="lang-powershell">$> python manage.py migrate EmployeeApp</code></pre>
                    <p>after execute the command check the tables created in the mysql database</p>
                    <p><img src="../assets/img/blogs/0020_6.png"></p>
                    <p><b>14.</b> Insert 1-2 records manually in the data tables.</p>
                    <p><b>15.</b> Lets create serializers for our models. Serialziers basically help to convert the complex types or model instances into native python data types that can be easily rendered into json or xml or other content types. They also help in serialization which is nothing but converting the past data back to complex types. Add a new file <b>serializers.py</b> and add following code in it </p>
                    <pre>
                    <code class="lang-powershell">
                    from rest_framework import serializers
                    from EmployeeApp.models import Departments, Employees
                    
                    class DepartmentSerializer(serializers.ModelSerializer):
                        class Meta:
                            model=Departments
                            fields=('DepartmentId', 'DepartmentName')
                    
                    class EmployeeSerializer(serializers.ModelSerializer):
                        class Meta:
                            model=Employees
                            fields=('EmployeeId', 'EmployeeName', 'Department', 'DateOfJoining', 'PhotoFileName')
                            
                    </code> 
                    </pre>
                    <p><b>16.</b> Lets now write the api methods as follows</p>
                    <pre>
                    <code class="lang-powershell">
                    from django.shortcuts import render
                    from django.views.decorators.csrf import csrf_exempt
                    from rest_framework.parsers import JSONParser
                    from django.http.response import JsonResponse
                    
                    from EmployeeApp.models import Departments, Employees
                    from EmployeeApp.serializers import DepartmentSerializer, EmployeeSerializer
                    
                    # Create your views here.
                    @csrf_exempt
                    def departmentAPI(request, id=0):
                        if request.method=='GET':
                            departments = Departments.objects.all()
                            departments_serializer = DepartmentSerializer(departments, many=True)
                            return JsonResponse(departments_serializer.data, safe=False)
                        elif request.method=='POST':
                            department_data = JSONParser().parse(request)
                            departments_serializer = DepartmentSerializer(data=department_data)
                            if departments_serializer.is_valid():
                                departments_serializer.save()
                                return JsonResponse("Added Successfully", safe=False)
                            return JsonResponse("Failed to Add", safe=False)
                        elif request.method=='PUT':
                            department_data = JSONParser().parse(request)
                            department=Departments.objects.get(DepartmentId=department_data['DepartmentId'])
                            departments_serializer=DepartmentSerializer(department, data=department_data)
                            if departments_serializer.is_valid():
                                departments_serializer.save()
                                return JsonResponse("Update Successfully", safe=False)
                            return JsonResponse("Failed to Update", safe=False)
                        elif request.method=='DELETE':
                            department=Departments.objects.get(DepartmentId=id)
                            department.delete()
                            return JsonResponse("Deleted Successfully", safe=False)
                            
                    </code>
                    </pre>  
                    <p><b>16.</b> Add the url routes to urls.py</p>
                    <pre>
                    <code class="lang-powershell">
                    from django.urls import path
                    from EmployeeApp import views
                    
                    urlpatterns=[
                        path('department', views.departmentAPI),
                        path('department/([0-9]+)', views.departmentAPI)
                    ]
                    </code>
                    </pre>
                    <p><b>17.</b> Next we need to include these urls into the main <b>urls.py</b> file</p>
                    <pre>
                    <code class="lang-python">
                    from django.contrib import admin
                    from django.urls import path, include
                    
                    urlpatterns = [
                        path('admin/', admin.site.urls),
                        path('', include('EmployeeApp.urls')),
                    ] 
                    </code>
                    </pre>
                    <p>Now start the server and test the api end points as mentioned below. (You can use postman or any other api client<br></p>
                    <p><b>Request Type:</b> GET, <b>URL:</b> http://127.0.0.1/department </p>
                    <p>Response:</p>
                    <pre>
                    <code class="lang-json">
                    [
                        {
                            "DepartmentId": 1,
                            "DepartmentName": "Accounts"
                        },
                        {
                            "DepartmentId": 2,
                            "DepartmentName": "IT"
                        }
                    ]
                    </code>
                    </pre>
                    <p><br><b>Request Type:</b> POST, <b>URL:</b> http://127.0.0.1/department</p>
                    <p><b>Request Body</b></p>
                    <pre>
                    <code class="lang-json">
                    {
                        "DepartmentName": "Sales"
                    }
                    </code>
                    </pre>
                    <p><b>Response</b></p>
                    <pre>
                    <code class="lang-json">
                    "Added Successfully"
                    </code>
                    </pre>
                    <p><br><b>Request Type:</b> PUT, <b>URL:</b> http://127.0.0.1/department</p>
                    <p><b>Request Body</b></p>
                    <pre>
                    <code class="lang-json">
                    {
                        "DepartmentId": "1",
                        "DepartmentName": "Accountss"
                    }
                    </code>
                    </pre>
                    <p><b>Response</b></p>
                    <pre>
                    <code class="lang-json">
                    "Update Successfully"
                    </code>
                    </pre>
                </div>
                <div class="Ad728">
                    <script type="text/javascript" src="../assets/js/728adcode.js"></script>
                </div>
            </div>
        </div>

    </div>
    <div id="footerArea"></div>
</body>
<script type="text/javascript" src="../assets/js/main.js"></script>

</html>